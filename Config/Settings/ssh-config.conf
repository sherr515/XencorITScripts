# =============================================================================
# SSH Server Configuration
# =============================================================================
# Purpose: Secure SSH server configuration with best practices
# Author: System Administrator
# Version: 1.0.0
# Date: $(date +%Y-%m-%d)
# =============================================================================

# SSH Server Configuration File
# This configuration implements security best practices for SSH server
# Copy this file to /etc/ssh/sshd_config and restart sshd service

# =============================================================================
# BASIC SETTINGS
# =============================================================================

# Port configuration
Port 22
# Alternative: Use non-standard port for security through obscurity
# Port 2222

# Address family
AddressFamily inet

# Listen on specific interfaces (uncomment and modify as needed)
# ListenAddress 0.0.0.0
# ListenAddress ::

# =============================================================================
# PROTOCOL SETTINGS
# =============================================================================

# Protocol version (use only SSH protocol 2)
Protocol 2

# Host key files
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key

# =============================================================================
# AUTHENTICATION SETTINGS
# =============================================================================

# Disable root login
PermitRootLogin no

# Password authentication (disable for key-based auth only)
PasswordAuthentication no
# Enable for mixed authentication
# PasswordAuthentication yes

# Public key authentication
PubkeyAuthentication yes

# Authorized keys file
AuthorizedKeysFile .ssh/authorized_keys

# Challenge-response authentication
ChallengeResponseAuthentication no

# GSSAPI authentication
GSSAPIAuthentication no
GSSAPICleanupCredentials no

# Kerberos authentication
KerberosAuthentication no
KerberosOrLocalPasswd no
KerberosTicketCleanup yes

# Use PAM
UsePAM yes

# =============================================================================
# SECURITY SETTINGS
# =============================================================================

# Login grace time (seconds)
LoginGraceTime 30

# Maximum authentication attempts
MaxAuthTries 3

# Maximum sessions per connection
MaxSessions 10

# Client alive settings
ClientAliveInterval 300
ClientAliveCountMax 3

# Compression
Compression no

# TCP keep alive
TCPKeepAlive yes

# =============================================================================
# LOGGING SETTINGS
# =============================================================================

# Log level
LogLevel INFO

# Syslog facility
SyslogFacility AUTH

# =============================================================================
# ACCESS CONTROL
# =============================================================================

# Allow/Deny users
# AllowUsers admin user1 user2
# DenyUsers root

# Allow/Deny groups
# AllowGroups ssh-users
# DenyGroups wheel

# =============================================================================
# ENVIRONMENT SETTINGS
# =============================================================================

# Environment variables
PermitUserEnvironment no

# Set environment variables
SetEnv TERM=xterm-256color

# =============================================================================
# CHANNEL SETTINGS
# =============================================================================

# X11 forwarding (disable for security)
X11Forwarding no

# X11 display offset
X11DisplayOffset 10

# X11 use localhost
X11UseLocalhost yes

# =============================================================================
# TUNNELING SETTINGS
# =============================================================================

# Allow TCP forwarding
AllowTcpForwarding no

# Gateway ports
GatewayPorts no

# Permit tunnel
PermitTunnel no

# =============================================================================
# SUBSYSTEM SETTINGS
# =============================================================================

# SFTP subsystem
Subsystem sftp /usr/lib/openssh/sftp-server

# =============================================================================
# ADVANCED SECURITY SETTINGS
# =============================================================================

# Ignore user known hosts
IgnoreUserKnownHosts yes

# Ignore rhosts
IgnoreRhosts yes

# Host-based authentication
HostbasedAuthentication no

# Rhosts RSA authentication
RhostsRSAAuthentication no

# Strict modes
StrictModes yes

# Use privilege separation
UsePrivilegeSeparation yes

# Permit empty passwords
PermitEmptyPasswords no

# =============================================================================
# CIPHER SETTINGS
# =============================================================================

# Ciphers (strong encryption only)
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr

# MAC algorithms
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256

# Key exchange algorithms
KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group14-sha256

# Host key algorithms
HostKeyAlgorithms ssh-rsa,rsa-sha2-256,rsa-sha2-512,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,ssh-ed25519

# =============================================================================
# RATE LIMITING
# =============================================================================

# Max startup connections
MaxStartups 10:30:60

# =============================================================================
# BANNER SETTINGS
# =============================================================================

# Banner file
Banner /etc/issue.net

# =============================================================================
# PAM SETTINGS
# =============================================================================

# PAM service name
PAMServiceName sshd

# =============================================================================
# SELINUX SETTINGS
# =============================================================================

# SELinux context
SELinuxContext sshd_t

# =============================================================================
# PERFORMANCE SETTINGS
# =============================================================================

# Use DNS
UseDNS no

# =============================================================================
# DEPRECATED SETTINGS (DO NOT USE)
# =============================================================================

# These settings are deprecated and should not be used:
# RSAAuthentication no
# Protocol 1
# PermitRootLogin yes
# PasswordAuthentication yes (without key-based auth)
# X11Forwarding yes (unless specifically needed)

# =============================================================================
# CONFIGURATION NOTES
# =============================================================================

# After making changes to this configuration:
# 1. Test the configuration: sshd -t
# 2. Restart the SSH service: systemctl restart sshd
# 3. Test connectivity from another session before closing current
# 4. Monitor logs: tail -f /var/log/auth.log

# Security recommendations:
# - Use key-based authentication only
# - Change default port (optional)
# - Use fail2ban for additional protection
# - Regular security audits
# - Keep SSH server updated

# =============================================================================
# EXAMPLE USER SSH CONFIGURATION
# =============================================================================

# For users, create ~/.ssh/config with:
# Host *
#     ServerAliveInterval 300
#     ServerAliveCountMax 3
#     Compression no
#     TCPKeepAlive yes
#     IdentitiesOnly yes
#     AddKeysToAgent yes
#     UseKeychain yes 